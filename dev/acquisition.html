<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Data Acquisition · RP DAQ Server</title><script data-outdated-warner src="assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.039/juliamono-regular.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.11/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="assets/documenter.js"></script><script src="siteinfo.js"></script><script src="../versions.js"></script><script src="../copy.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="index.html"><img src="assets/logo.png" alt="RP DAQ Server logo"/></a><div class="docs-package-name"><span class="docs-autofit"><a href="index.html">RP DAQ Server</a></span></div><form class="docs-search" action="search.html"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="index.html">Home</a></li><li><a class="tocitem" href="architecture.html">Architecture</a></li><li><a class="tocitem" href="installation.html">Installation</a></li><li><a class="tocitem" href="connections.html">Connections</a></li><li><a class="tocitem" href="cluster.html">Cluster</a></li><li><a class="tocitem" href="client.html">Client</a></li><li class="is-active"><a class="tocitem" href="acquisition.html">Data Acquisition</a><ul class="internal"><li><a class="tocitem" href="#Considerations-for-Sample-Retrieval"><span>Considerations for Sample Retrieval</span></a></li><li><a class="tocitem" href="#Considerations-for-Frame-Retrieval/Julia-Client"><span>Considerations for Frame Retrieval/Julia Client</span></a></li></ul></li><li><a class="tocitem" href="generation.html">Signal Generation</a></li><li><span class="tocitem">Examples</span><ul><li><a class="tocitem" href="examples/simple.html">Simple</a></li><li><a class="tocitem" href="examples/waveforms.html">Waveforms</a></li><li><a class="tocitem" href="examples/slowADC.html">SlowADC</a></li></ul></li><li><a class="tocitem" href="scpi.html">SCPI Interface</a></li><li><a class="tocitem" href="fpga.html">FPGA Development</a></li><li><a class="tocitem" href="devtips.html">Development Tips</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href="acquisition.html">Data Acquisition</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href="acquisition.html">Data Acquisition</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/tknopp/RedPitayaDAQServer/blob/master/docs/src/acquisition.md" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="Data-Acqusition"><a class="docs-heading-anchor" href="#Data-Acqusition">Data Acqusition</a><a id="Data-Acqusition-1"></a><a class="docs-heading-anchor-permalink" href="#Data-Acqusition" title="Permalink"></a></h1><p>The data acqusition of the RedPitayaDAQServer project is based on two data flows to and from the upper 128 MB of the RedPitaya memory. This memory region acts as a ring buffer for the acquired samples and can be queried by clients using SCPI commands.</p><p>Once triggered to start via the master trigger, each FPGA in a cluster continously writes the sampled signals into their respective buffers. Both ADC channels on a RedPitaya are written to the buffer at the same time and the 16-bit samples are concatenated into one 32-bit value. The sampling rate of the system can be adjusted by setting a decimation parameter. Decimation is realized by using a CIC filter.</p><p>Internally the FPGA keeps track of a 64-bit writepointer register pointing into the ring buffer and increments this value with each new sample pair. Additionally the writepointer also counts the number of buffer overflows. As the size of the buffer region is a power of two, the lower 25 bits of the writepointer are the buffer location and the remaining bits are the overflow counter. The writepointer can be directly interpreted as the total number of samples written since the data acquisition was started. The current writepointer value can be queried by a SCPI command.</p><p>In the SCPI commands for sample retrieval a client can supply a similar pointer, a readpointer, to the server together with the number of samples to retrieve. The server then extracts the buffer position from the readpointer and transmits the requested amount of samples over the data socket. This transmission happens either way, even if the samples are overwritten. However, the server uses the whole readpointer, including the buffer overflows, to check if the requested samples were overwritten.</p><p>If the distance between the write- and readpointer is larger than the buffer size the <code>overflow</code> status flag is set. If during the transmission the requested samples are overwritten the <code>corrupted</code> flag is set. These flags can be queried individually or together in a status byte via SCPI commands.</p><h2 id="Considerations-for-Sample-Retrieval"><a class="docs-heading-anchor" href="#Considerations-for-Sample-Retrieval">Considerations for Sample Retrieval</a><a id="Considerations-for-Sample-Retrieval-1"></a><a class="docs-heading-anchor-permalink" href="#Considerations-for-Sample-Retrieval" title="Permalink"></a></h2><p>There are several things to consider when attempting to retrieve samples at a high sampling rate, larger cluster sizes or for longer periods of time. Most of the following points were implemented/considered in the Julia reference implementation, but would become relevant when implementing new clients.</p><p>As the server will always transmit samples just based on the buffer position of a readpointer, if a client wants to only receive certain samples it needs to wait for them to exist in the buffer. This requires querying the writepointer until it is larger than the desired readpointer.</p><p>If the number of requested samples is larger than the buffer, the sample should be requested in smaller chunks as the server would otherwise return samples that were not written yet. In a cluster scenario the i-th chunk should be requested from all RedPitayas in the cluster before requesting the next chunk.</p><h2 id="Considerations-for-Frame-Retrieval/Julia-Client"><a class="docs-heading-anchor" href="#Considerations-for-Frame-Retrieval/Julia-Client">Considerations for Frame Retrieval/Julia Client</a><a id="Considerations-for-Frame-Retrieval/Julia-Client-1"></a><a class="docs-heading-anchor-permalink" href="#Considerations-for-Frame-Retrieval/Julia-Client" title="Permalink"></a></h2><p>Producer/Consumer</p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="client.html">« Client</a><a class="docs-footer-nextpage" href="generation.html">Signal Generation »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 0.27.12 on <span class="colophon-date" title="Wednesday 19 January 2022 16:34">Wednesday 19 January 2022</span>. Using Julia version 1.5.4.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
